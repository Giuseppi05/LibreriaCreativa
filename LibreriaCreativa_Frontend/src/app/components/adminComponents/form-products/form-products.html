<form (ngSubmit)="submit()" [formGroup]="form" enctype="multipart/form-data">
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <input type="hidden" formControlName="id" />

  <div class="row">
    <div class="col-md-6 mb-3">
      <label class="form-label">Nombre</label>
      <input
        class="form-control"
        formControlName="name"
        [ngClass]="{'is-invalid': controlInvalid('name')}"
        placeholder="Nombre"
      />
      <div *ngIf="controlInvalid('name')" class="invalid-feedback">
        Nombre es obligatorio.
      </div>
    </div>

    <div class="col-md-6 mb-3">
      <label class="form-label">Marca</label>
      <input
        class="form-control"
        formControlName="marca"
        [ngClass]="{'is-invalid': controlInvalid('marca')}"
        placeholder="Marca"
      />
      <div *ngIf="controlInvalid('marca')" class="invalid-feedback">
        Marca es obligatoria.
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-4 mb-3">
      <label class="form-label">Precio</label>
      <div class="input-group">
        <span class="input-group-text">S/.</span>
        <input
          type="number"
          class="form-control"
          formControlName="precio"
          [ngClass]="{'is-invalid': controlInvalid('precio')}"
          step="0.01"
          min="0"
        />
        <div *ngIf="controlInvalid('precio')" class="invalid-feedback">
          Precio válido obligatorio.
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-3">
      <label class="form-label">Stock</label>
      <input
        type="number"
        class="form-control"
        formControlName="stock"
        [ngClass]="{'is-invalid': controlInvalid('stock')}"
        min="0"
      />
      <div *ngIf="controlInvalid('stock')" class="invalid-feedback">
        Stock válido obligatorio.
      </div>
    </div>

    <div class="col-md-4 mb-3">
      <label class="form-label">Categoría</label>
      <select
        class="form-select"
        formControlName="categoryId"
        [ngClass]="{'is-invalid': controlInvalid('categoryId')}"
      >
        <option *ngFor="let c of categories" [value]="c.id">
          {{ c.name }}
        </option>
      </select>
      <div *ngIf="controlInvalid('categoryId')" class="invalid-feedback">
        Categoría obligatoria.
      </div>
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Descripción</label>
    <textarea
      class="form-control"
      formControlName="description"
      [ngClass]="{'is-invalid': controlInvalid('description')}"
      rows="3"
    ></textarea>
    <div *ngIf="controlInvalid('description')" class="invalid-feedback">
      Descripción obligatoria.
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Imagen</label>
    <input
      type="file"
      class="form-control"
      (change)="onFileChange($event)"
      accept="image/*"
      [ngClass]="{'is-invalid': controlInvalid('imageFile')}"
    />
    <div *ngIf="controlInvalid('imageFile')" class="invalid-feedback">
      Imagen obligatoria.
    </div>
    <div class="mt-2" *ngIf="imagePreview">
      <img
        [src]="imagePreview"
        alt="Vista previa"
        class="img-thumbnail"
        style="max-width: 200px"
      />
    </div>
  </div>

  <div class="mb-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <label class="form-label">Especificaciones</label>
      <button type="button" class="btn btn-sm btn-main" (click)="addSpec()">
        <i class="fas fa-plus"></i> Añadir
      </button>
    </div>
    <div formArrayName="specs">
      <div
        class="row mb-2"
        *ngFor="let spec of specs.controls; let i = index"
        [formGroupName]="i"
      >
        <div class="col-md-5">
          <input
            class="form-control"
            formControlName="name"
            placeholder="Nombre"
            required
          />
        </div>
        <div class="col-md-6">
          <input
            class="form-control"
            formControlName="value"
            placeholder="Valor"
            required
          />
        </div>
        <div class="col-md-1">
          <button
            type="button"
            class="btn btn-sm btn-outline-danger w-100 h-100"
            (click)="removeSpec(i)"
          >
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <hr />

  <div class="mb-4">
    <div class="form-check form-switch">
      <label class="form-check-label">Producto Activo</label>
      <input
        class="form-check-input"
        type="checkbox"
        formControlName="active"
      />
    </div>
  </div>

  <div class="d-flex justify-content-end">
    <button type="submit" class="btn btn-main" [disabled]="form.invalid">
      Guardar
    </button>
  </div>
</form>
