<div *ngIf="order">
  <div class="accordion-body bg-white">
    <h5 class="fw-bold color-text mb-3">Pedido #{{ order.id }}</h5>

    <!-- Productos -->
    <div class="border rounded bg-light p-2 mb-3">
      <div class="fw-bold text-muted border-bottom pb-2 mb-2">Productos</div>
      <div
        *ngFor="let detalle of order.detalles"
        class="d-flex align-items-center border-bottom py-2"
      >
        <img
          [src]="detalle.producto.img"
          alt="{{detalle.producto.name}}"
          class="rounded me-2"
          style="width: 50px; height: 50px; object-fit: cover"
        />
        <div class="flex-grow-1">
          <div class="fw-bold">{{ detalle.producto.name }}</div>
          <small class="text-muted">x{{ detalle.cantidad }}</small>
        </div>
        <div class="text-end">S/. {{ detalle.subtotal | number:'1.2-2' }}</div>
      </div>
    </div>

    <!-- Totales -->
    <div class="mt-3">
      <div class="d-flex justify-content-between">
        <span class="text-muted">Subtotal</span>
        <span>S/. {{ order.subtotal | number:'1.2-2' }}</span>
      </div>
      <div class="d-flex justify-content-between">
        <span class="text-muted">Descuento</span>
        <span
          >S/. {{ order.descuento ? (order.descuento | number:'1.2-2') : '0.00'
          }}</span
        >
      </div>
      <div class="d-flex justify-content-between">
        <span class="text-muted">Envío</span>
        <span>S/. {{ order.envio | number:'1.2-2' }}</span>
      </div>
      <div class="d-flex justify-content-between fw-bold border-top pt-2 mt-2">
        <span>Total</span>
        <span>S/. {{ order.total | number:'1.2-2' }}</span>
      </div>
    </div>

    <!-- Datos del pedido -->
    <div class="mt-4 p-3 border rounded bg-light">
      <h6 class="fw-bold color-text mb-3">Detalles del Pedido</h6>
      <dl class="row mb-0">
        <dt class="col-sm-4 text-muted small">Entrega</dt>
        <dd class="col-sm-8 mb-2">
          <span class="text-dark small">
            {{ order.direccion ? order.direccion : "Recojo en Tienda" }}
          </span>
        </dd>
        <dt class="col-sm-4 text-muted small">Estado</dt>
        <dd class="col-sm-8 mb-2">
          <span
            class="badge text-white"
            [ngClass]="order.estado.name === 'Cancelado' ? 'bg-danger' : 'bg-main'"
          >
            {{ order.estado.name || 'Sin estado' }}
          </span>
        </dd>
        <dt class="col-sm-4 text-muted small">Medio de Pago</dt>
        <dd class="col-sm-8 mb-2">
          <span class="text-dark small">
            {{ order.payments?.[0]?.tipo | titlecase }}
          </span>
        </dd>
      </dl>

      <!-- Botones de acción -->
      <div class="d-flex gap-2 flex-wrap justify-content-end mt-3">
        <button
          *ngIf="order?.payments?.[0]?.imgYape"
          class="btn btn-sec bg-sec text-white"
          (click)="openYapeModal(order.payments?.[0]?.imgYape)"
        >
          <i class="fas fa-receipt me-2"></i> Ver Comprobante
        </button>

        <a
          *ngIf="order?.rutaBoleta"
          class="btn btn-main"
          [href]="order.rutaBoleta"
          target="_blank"
        >
          <i class="fas fa-file-pdf me-2"></i> Ver Boleta PDF
        </a>
      </div>
    </div>
  </div>
</div>
<app-modal-component
  *ngIf="(modalService.isOpen$ | async)"
  [title]="'Comprobante Yape'"
  (closed)="closeYapeModal()"
>
  <div class="text-center">
    <img
      [src]="selectedYapeImage"
      alt="Comprobante Yape"
      class="img-fluid rounded"
      style="max-width: 400px; width: 100%; height: auto; object-fit: contain"
    />
  </div>
  <div class="text-end mt-3">
    <button class="btn btn-sec bg-sec text-white" (click)="closeYapeModal()">
      Cerrar
    </button>
  </div>
</app-modal-component>
