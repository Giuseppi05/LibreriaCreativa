<div class="container-fluid mt-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">Administrador</li>
      <li class="breadcrumb-item active" aria-current="page">Pedidos</li>
    </ol>
  </nav>

  <!-- Título -->
  <div
    class="d-flex flex-column flex-sm-row justify-content-between align-items-center mb-3 gap-2"
  >
    <h2 class="mb-0">Pedidos</h2>
  </div>

  <!-- Errores -->
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <!-- Tabla -->
  <div class="table-responsive">
    <table class="table table-striped table-hover table-bordered text-center">
      <thead class="thead-light">
        <tr>
          <th scope="col">Id</th>
          <th scope="col">Usuario</th>
          <th scope="col">Correo</th>
          <th scope="col">Total</th>
          <th scope="col">Fecha</th>
          <th scope="col">Estado</th>
          <th scope="col" class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let orden of page?.content">
          <th scope="row">{{ orden.id }}</th>
          <td>{{ orden.user.name }}</td>
          <td>{{ orden.user.email }}</td>
          <td>S/. {{ orden.total }}</td>
          <td>{{ orden.createdAt | date: 'dd/MM/yyyy (HH:mm)' }}</td>

          <!-- Columna Estado -->
          <td>
            <span
              class="badge text-white"
              [ngClass]="{
              'bg-warning': orden.estado.name === 'Pendiente',
              'bg-primary': orden.estado.name === 'Aprobado',
              'bg-info': orden.estado.name === 'Enviado',
              'bg-success': orden.estado.name === 'Entregado',
              'bg-danger': orden.estado.name === 'Cancelado',
              'bg-dark': orden.estado.name === 'Pagado'
            }"
            >
              {{ orden.estado.name }}
            </span>
          </td>

          <!-- Acciones -->
          <td class="text-center">
            <button
              class="btn btn-sm"
              (click)="openDetailModal(orden)"
              title="Ver Detalles"
            >
              <i class="fas fa-eye"></i>
            </button>
            <button
              class="btn btn-sm"
              (click)="openStatusModal(orden)"
              title="Cambiar Estado"
            >
              <i class="fas fa-sync-alt"></i>
            </button>
          </td>
        </tr>

        <!-- Sin resultados -->
        <tr *ngIf="!page?.content?.length">
          <td colspan="7" class="text-center">No hay órdenes para mostrar.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <nav *ngIf="page && page.totalPages > 1" aria-label="Page navigation">
    <ul class="pagination pagination-custom justify-content-center mt-4">
      <!-- Anterior -->
      <li class="page-item" [class.disabled]="page.number === 0">
        <button
          class="page-link"
          (click)="cargar(page.number - 1)"
          [disabled]="page.number === 0"
        >
          &laquo;
        </button>
      </li>

      <!-- Páginas -->
      <li
        class="page-item"
        *ngFor="let i of totalPagesArray()"
        [class.active]="i === page.number"
      >
        <button class="page-link" (click)="cargar(i)">{{ i + 1 }}</button>
      </li>

      <!-- Siguiente -->
      <li
        class="page-item"
        [class.disabled]="page.number >= page.totalPages - 1"
      >
        <button
          class="page-link"
          (click)="cargar(page.number + 1)"
          [disabled]="page.number >= page.totalPages - 1"
        >
          &raquo;
        </button>
      </li>
    </ul>
  </nav>

  <!-- Info de página -->
  <div class="text-center text-muted small mb-3" *ngIf="page">
    Mostrando {{ page.content.length }} de {{ page.totalElements }} productos.
    Página {{ page.number + 1 }} de {{ page.totalPages }}.
  </div>
</div>
<app-modal-component
  *ngIf="(modalService.isOpen$ | async)"
  [title]="modalView === 'detail' ? 'Detalle de Pedido' : 'Cambiar Estado'"
  (closed)="closeModal()"
>
  <app-order-detail
    *ngIf="modalView === 'detail'"
    [order]="selectedOrder"
  ></app-order-detail>

  <app-status-change
    *ngIf="modalView === 'status'"
    [order]="selectedOrder"
    (statusChanged)="cambiarEstado($event)"
  ></app-status-change>
</app-modal-component>
