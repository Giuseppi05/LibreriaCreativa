<div class="container-fluid mt-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">Administrador</li>
      <li class="breadcrumb-item active" aria-current="page">Cupones</li>
    </ol>
  </nav>

  <!-- Título y botón -->
  <div
    class="d-flex flex-column flex-sm-row justify-content-between align-items-center mb-3 gap-2"
  >
    <h2 class="mb-0">Cupones</h2>
    <button class="btn bg-main text-white" (click)="openModal()">
      <i class="fas fa-plus"></i> NUEVO CUPÓN
    </button>
  </div>

  <!-- Mensajes -->
  <div *ngIf="success" class="alert alert-success">{{ success }}</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <!-- Tabla -->
  <div class="table-responsive">
    <table class="table table-striped table-hover table-bordered text-center">
      <thead class="thead-light">
        <tr>
          <th scope="col">Id</th>
          <th scope="col">Codigo</th>
          <th scope="col">Descuento (%)</th>
          <th scope="col">Activo</th>
          <th scope="col" class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of page?.content">
          <th scope="row">{{ c.id }}</th>
          <td>{{ c.codigoCupon }}</td>
          <td>{{ c.descuento + '%' }}</td>
          <td>{{ c.activo ? 'Activo' : 'Inactivo' }}</td>
          <td class="text-center">
            <button class="btn btn-sm" (click)="editar(c)">
              <i class="fas fa-edit"></i>
            </button>
            <button
              class="btn btn-sm btn-outline"
              title="Eliminar"
              (click)="borrar(c.id)"
            >
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        </tr>
        <tr *ngIf="!page?.content?.length">
          <td colspan="3" class="text-center">
            No hay categorías para mostrar.
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <nav *ngIf="page && page.totalPages > 1" aria-label="Page navigation">
    <ul class="pagination pagination-custom justify-content-center mt-4">
      <!-- Anterior -->
      <li class="page-item" [class.disabled]="page.number === 0">
        <button
          class="page-link"
          (click)="cargar(page.number - 1)"
          [disabled]="page.number === 0"
        >
          &laquo;
        </button>
      </li>

      <!-- Páginas -->
      <li
        class="page-item"
        *ngFor="let i of totalPagesArray()"
        [class.active]="i === page.number"
      >
        <button class="page-link" (click)="cargar(i)">{{ i + 1 }}</button>
      </li>

      <!-- Siguiente -->
      <li
        class="page-item"
        [class.disabled]="page.number >= page.totalPages - 1"
      >
        <button
          class="page-link"
          (click)="cargar(page.number + 1)"
          [disabled]="page.number >= page.totalPages - 1"
        >
          &raquo;
        </button>
      </li>
    </ul>
  </nav>

  <!-- Info de página -->
  <div class="text-center text-muted small mb-3" *ngIf="page">
    Mostrando {{ page.content.length }} de {{ page.totalElements }} productos.
    Página {{ page.number + 1 }} de {{ page.totalPages }}.
  </div>

  <!-- MODAL -->
  <app-modal-component
    *ngIf="(modalService.isOpen$ | async)"
    [title]="'Cupón'"
    (closed)="closeModal()"
  >
    <app-form-coupons
      [initialCoupon]="couponToEdit"
      (saved)="onCouponSaved($event)"
    ></app-form-coupons>
  </app-modal-component>
</div>
