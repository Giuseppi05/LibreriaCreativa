<div class="container-fluid mt-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">Administrador</li>
      <li class="breadcrumb-item active" aria-current="page">Productos</li>
    </ol>
  </nav>

  <!-- Header -->
  <div
    class="d-flex flex-column flex-sm-row justify-content-between align-items-center mb-3 gap-2"
  >
    <h2 class="mb-0">Productos</h2>
    <button class="btn bg-main text-white" (click)="openModal()">
      <i class="fas fa-plus"></i> NUEVO PRODUCTO
    </button>
  </div>

  <!-- Alerts -->
  <div *ngIf="success" class="alert alert-success">{{ success }}</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <!-- Tabla -->
  <div class="table-responsive">
    <table
      class="table table-striped table-hover table-bordered text-center align-middle"
    >
      <thead class="thead-light">
        <tr>
          <th>Imagen</th>
          <th>Nombre</th>
          <th>Categoría</th>
          <th>Stock</th>
          <th>Precio</th>
          <th>Estado</th>
          <th class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let producto of page?.content"
          class="justify-content-center align-items-center"
        >
          <td>
            <img
              [src]="producto.img"
              [alt]="'Imagen de ' + producto.name"
              style="max-width: 100px; max-height: 100px"
            />
          </td>
          <td>{{ producto.name }}</td>
          <td>{{ producto.category?.name }}</td>
          <td>{{ producto.stock }}</td>
          <td>{{ producto.precio | currency:'S/. ' }}</td>
          <td>{{ producto.active ? 'Activo' : 'Inactivo' }}</td>
          <td class="text-center">
            <button class="btn btn-sm btn-edit" (click)="editar(producto)">
              <i class="fas fa-edit"></i>
            </button>
            <button
              class="btn btn-sm btn-outline"
              title="Eliminar"
              (click)="borrar(producto.id)"
            >
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        </tr>

        <tr *ngIf="!page?.content?.length">
          <td colspan="7" class="text-center">
            No hay productos para mostrar.
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <nav *ngIf="page && page.totalPages > 1" aria-label="Page navigation">
    <ul class="pagination pagination-custom justify-content-center mt-4">
      <!-- Anterior -->
      <li class="page-item" [class.disabled]="page.number === 0">
        <button
          class="page-link"
          (click)="cargar(page.number - 1)"
          [disabled]="page.number === 0"
        >
          &laquo;
        </button>
      </li>

      <!-- Páginas -->
      <li
        class="page-item"
        *ngFor="let i of totalPagesArray()"
        [class.active]="i === page.number"
      >
        <button class="page-link" (click)="cargar(i)">{{ i + 1 }}</button>
      </li>

      <!-- Siguiente -->
      <li
        class="page-item"
        [class.disabled]="page.number >= page.totalPages - 1"
      >
        <button
          class="page-link"
          (click)="cargar(page.number + 1)"
          [disabled]="page.number >= page.totalPages - 1"
        >
          &raquo;
        </button>
      </li>
    </ul>
  </nav>

  <!-- Info de página -->
  <div class="text-center text-muted small mb-3" *ngIf="page">
    Mostrando {{ page.content.length }} de {{ page.totalElements }} productos.
    Página {{ page.number + 1 }} de {{ page.totalPages }}.
  </div>
</div>

<app-modal-component
  *ngIf="(modalService.isOpen$ | async)"
  [title]="'Producto'"
  (closed)="closeModal()"
>
  <app-form-products
    [initialProduct]="productToEdit"
    (saved)="onProductSaved($event)"
  >
  </app-form-products>
</app-modal-component>
