<div class="container-fluid mt-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">Administrador</li>
      <li class="breadcrumb-item active" aria-current="page">Mensajes</li>
    </ol>
  </nav>

  <!-- Header -->
  <div
    class="d-flex flex-column flex-sm-row justify-content-between align-items-center mb-3 gap-2"
  >
    <h2 class="mb-0">Mensajes</h2>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger text-center">{{ error }}</div>

  <!-- Tabla -->
  <div class="table-responsive">
    <table class="table table-striped table-hover table-bordered text-center">
      <thead class="thead-light">
        <tr>
          <th scope="col">Nombre</th>
          <th scope="col">Correo</th>
          <th scope="col">Asunto</th>
          <th scope="col" class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let mensaje of page?.content">
          <td>{{ mensaje.name }}</td>
          <td>{{ mensaje.email }}</td>
          <td>{{ mensaje.affair }}</td>
          <td class="text-center">
            <button class="btn btn-sm" (click)="abrirModal(mensaje)">
              <i class="fas fa-eye"></i>
            </button>
          </td>
        </tr>
        <tr *ngIf="!page?.content?.length">
          <td colspan="5" class="text-center">No hay mensajes para mostrar.</td>
        </tr>
      </tbody>
    </table>

    <!-- Paginaci칩n -->
    <nav *ngIf="page && page.totalPages > 1" aria-label="Page navigation">
      <ul class="pagination pagination-custom justify-content-center mt-4">
        <!-- Anterior -->
        <li class="page-item" [class.disabled]="page.number === 0">
          <button
            class="page-link"
            (click)="cargar(page.number - 1)"
            [disabled]="page.number === 0"
          >
            &laquo;
          </button>
        </li>

        <!-- P치ginas -->
        <li
          class="page-item"
          *ngFor="let i of totalPagesArray()"
          [class.active]="i === page.number"
        >
          <button class="page-link" (click)="cargar(i)">{{ i + 1 }}</button>
        </li>

        <!-- Siguiente -->
        <li
          class="page-item"
          [class.disabled]="page.number >= page.totalPages - 1"
        >
          <button
            class="page-link"
            (click)="cargar(page.number + 1)"
            [disabled]="page.number >= page.totalPages - 1"
          >
            &raquo;
          </button>
        </li>
      </ul>
    </nav>

    <!-- Info de p치gina -->
    <div class="text-center text-muted small mb-3" *ngIf="page">
      Mostrando {{ page.content.length }} de {{ page.totalElements }} productos.
      P치gina {{ page.number + 1 }} de {{ page.totalPages }}.
    </div>

    <!-- Modal -->
    <app-modal-component
      *ngIf="(modalService.isOpen$ | async)"
      [title]="'Mensaje'"
      (closed)="closeModal()"
    >
      <div class="email-view p-3">
        <div class="border-bottom mb-3 pb-2">
          <h5 class="fw-bold mb-1">
            {{ selectedMessage?.affair || '(Sin asunto)' }}
          </h5>
          <div class="d-flex align-items-center text-muted small">
            <i class="fas fa-user-circle me-2"></i>
            <span class="me-2"
              >{{ selectedMessage?.name || 'Desconocido' }}</span
            >
            &lt;{{ selectedMessage?.email || 'correo@ejemplo.com' }}&gt;
          </div>
        </div>

        <div class="message-body mb-3" style="white-space: pre-wrap">
          {{ selectedMessage?.message || '(Sin contenido)' }}
        </div>

        <div class="text-end">
          <button class="btn btn-sec bg-sec text-white" (click)="closeModal()">
            Cerrar
          </button>
        </div>
      </div>
    </app-modal-component>
  </div>
</div>
